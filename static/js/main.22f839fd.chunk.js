(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{185:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),u=r(72),i=r.n(u),s=r(25),c=r(40),o=r(43),l=r(41),d=r(44),f=r(76),p=r(45),v=r(6),m=r.n(v),h=r(17),w=r(42),b=r.n(w),E=function e(){Object(s.a)(this,e),this.repositories=[],this.pullRequests=[],this.reviewRequests=[],this.reviews=[]},y=b.a.parse(location.search),g="string"===typeof y.repo?y.repo:null,q=function(e,t){return Object(h.a)(m.a.mark(function r(){var n,a,u;return m.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n="cache:".concat(e).concat(g?"?repo=".concat(g):""),!(a=localStorage.getItem(n))){r.next=8;break}return u=JSON.parse(a||"")||[],console.log("loaded ".concat(e,": ").concat(u.length)),r.abrupt("return",u);case 8:return r.next=10,t();case 10:u=r.sent,localStorage.setItem(n,JSON.stringify(u)),console.log("discovered ".concat(e,": ").concat(u.length));case 13:return r.abrupt("return",u);case 14:case"end":return r.stop()}},r)}))},k=function(e){function t(){var e,r;Object(s.a)(this,t);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];return(r=Object(o.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).token=void 0,r.discoverRepositories=q("repositories",function(){y.org;var e=y.repo,t=function(e){return{fullName:e.full_name,id:e.id}};if(e)return r.query("/repos/".concat(e)).then(function(e){return[t(e)]});throw new Error("please don't make me load everything....")}),r.discoverPullRequests=q("pull-requests",Object(h.a)(m.a.mark(function e(){var t,n,a,u,i,s,c,o,l,d,f,p,v,h,w;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,a=!1,u=void 0,e.prev=4,i=r.repositories[Symbol.iterator]();case 6:if(n=(s=i.next()).done){e.next=48;break}return c=s.value,e.prev=8,e.next=11,r.queryAllPages("/repos/".concat(c.fullName,"/pulls"),{state:"all"});case 11:o=e.sent,l=!0,d=!1,f=void 0,e.prev=15,p=o[Symbol.iterator]();case 17:if(l=(v=p.next()).done){e.next=26;break}return h=v.value,e.next=21,r.queryAllPages("/repos/".concat(c.fullName,"/pulls/").concat(h.number,"/commits"));case 21:w=e.sent,t.push({opener:h.user.login,commits:w.map(function(e){return{date:e.commit.committer.date}}),mergedAt:h.merged_at,createdAt:h.created_at,title:h.title,repoFullName:c.fullName,repoId:c.id,id:h.number});case 23:l=!0,e.next=17;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(15),d=!0,f=e.t0;case 32:e.prev=32,e.prev=33,l||null==p.return||p.return();case 35:if(e.prev=35,!d){e.next=38;break}throw f;case 38:return e.finish(35);case 39:return e.finish(32);case 40:e.next=45;break;case 42:e.prev=42,e.t1=e.catch(8),console.error(e.t1);case 45:n=!0,e.next=6;break;case 48:e.next=54;break;case 50:e.prev=50,e.t2=e.catch(4),a=!0,u=e.t2;case 54:e.prev=54,e.prev=55,n||null==i.return||i.return();case 57:if(e.prev=57,!a){e.next=60;break}throw u;case 60:return e.finish(57);case 61:return e.finish(54);case 62:return e.abrupt("return",t);case 63:case"end":return e.stop()}},e,null,[[4,50,54,62],[8,42],[15,28,32,40],[33,,35,39],[55,,57,61]])}))),r.discoverReviewRequests=q("review-requests",Object(h.a)(m.a.mark(function e(){var t,n,a,u,i,s,c;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,a=!1,u=void 0,e.prev=4,i=m.a.mark(function e(){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.value,e.t0=t.push,e.t1=t,e.t2=p.a,e.next=6,r.queryAllPages("/repos/".concat(n.repoFullName,"/issues/").concat(n.id,"/events")).then(function(e){return e.filter(function(e){return"review_requested"===e.event&&e.requested_reviewer}).map(function(e){return{prTitle:n.title,prId:n.id,requestedReviewer:e.requested_reviewer.login,requestedAt:e.created_at}})});case 6:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 9:case"end":return e.stop()}},e)}),s=r.pullRequests[Symbol.iterator]();case 7:if(n=(c=s.next()).done){e.next=12;break}return e.delegateYield(i(),"t0",9);case 9:n=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),a=!0,u=e.t1;case 18:e.prev=18,e.prev=19,n||null==s.return||s.return();case 21:if(e.prev=21,!a){e.next=24;break}throw u;case 24:return e.finish(21);case 25:return e.finish(18);case 26:return e.abrupt("return",t);case 27:case"end":return e.stop()}},e,null,[[4,14,18,26],[19,,21,25]])}))),r.discoverReviews=q("reviews",Object(h.a)(m.a.mark(function e(){var t,n,a,u,i,s,c;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,a=!1,u=void 0,e.prev=4,i=m.a.mark(function e(){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.value,e.t0=t.push,e.t1=t,e.t2=p.a,e.next=6,r.queryAllPages("/repos/".concat(n.repoFullName,"/pulls/").concat(n.id,"/reviews")).then(function(e){return e.map(function(e){return{prId:n.id,reviewer:e.user.login,reviewedAt:e.submitted_at,state:e.state}})});case 6:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 9:case"end":return e.stop()}},e)}),s=r.pullRequests[Symbol.iterator]();case 7:if(n=(c=s.next()).done){e.next=12;break}return e.delegateYield(i(),"t0",9);case 9:n=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),a=!0,u=e.t1;case 18:e.prev=18,e.prev=19,n||null==s.return||s.return();case 21:if(e.prev=21,!a){e.next=24;break}throw u;case 24:return e.finish(21);case 25:return e.finish(18);case 26:return e.abrupt("return",t);case 27:case"end":return e.stop()}},e,null,[[4,14,18,26],[19,,21,25]])}))),r}return Object(d.a)(t,e),Object(c.a)(t,[{key:"setToken",value:function(e){this.token=e}},{key:"load",value:function(){var e=Object(h.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.discoverRepositories();case 2:return this.repositories=e.sent,e.next=5,this.discoverPullRequests();case 5:return this.pullRequests=e.sent,e.next=8,this.discoverReviewRequests();case 8:return this.reviewRequests=e.sent,e.next=11,this.discoverReviews();case 11:this.reviews=e.sent;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryAllPages",value:function(){var e=Object(h.a)(m.a.mark(function e(t){var r,n,a,u,i,s=arguments;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=s.length>1&&void 0!==s[1]?s[1]:{},n=[],a=100,u=1,i=[];case 5:return e.next=7,this.query(t,Object(f.a)({},r,{page:String(u++),per_page:String(a)}));case 7:i=e.sent,n.push.apply(n,Object(p.a)(i));case 9:if(i.length===a){e.next=5;break}case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URL("https://api.github.com".concat(e));return Object.keys(t).forEach(function(e){return r.searchParams.append(e,t[e])}),fetch(r.toString(),{headers:{Authorization:"token ".concat(this.token)}}).then(function(e){return e.json()})}}]),t}(E),R=r(75),A=r.n(R),x=r(16),O=r.n(x),j=r(74),I=r.n(j),_=r(14),S=r(29),T=r.n(S),N=r(2),P=r.n(N),C=r(30),B=r.n(C),M=r(32),D=r.n(M),L=r(3),U=r.n(L),V=r(31),F=r.n(V),H=r(13),J=r.n(H),G=r(15),W=function(e,t,r){var n=new E;return n.reviewRequests=e.reviewRequests.filter(function(e){var n=e.requestedAt;return P()(n).isBetween(t,r)}),n.reviews=e.reviews.filter(function(t){var r=function(e,t){var r=e.reviews.filter(function(e){return e.prId===t.prId&&e.reviewer===t.reviewer&&P()(e.reviewedAt).isBefore(t.reviewedAt)}).sort(function(e){return P()(e.reviewedAt).unix()}).reverse()[0];return e.reviewRequests.filter(function(e){return e.prId===t.prId&&e.requestedReviewer===t.reviewer&&P()(e.requestedAt).isBefore(t.reviewedAt)&&(!r||P()(e.requestedAt).isAfter(r.reviewedAt))}).sort(function(e){return P()(e.reviewedAt).unix()}).reverse()[0]}(e,t);return r&&n.reviewRequests.indexOf(r)>-1}),n.pullRequests=e.pullRequests.filter(function(e){var t=e.id;return!!n.reviews.find(function(e){return e.prId===t})}),n.repositories=e.repositories.filter(function(e){var t=e.id;return!!n.pullRequests.find(function(e){return e.repoId===t})}),n},z=function(e,t,r){var n=new E;return n.pullRequests=e.pullRequests.filter(function(e){var n=e.createdAt;return P()(n).isBetween(t,r)}),n.repositories=e.repositories.filter(function(e){var t=e.id;return!!n.pullRequests.find(function(e){return e.repoId===t})}),n.reviews=e.reviews.filter(function(e){var t=e.prId;return!!n.pullRequests.find(function(e){var r=e.id;return t===r})}),n.reviewRequests=e.reviewRequests.filter(function(e){var t=e.prId;return!!n.pullRequests.find(function(e){var r=e.id;return t===r})}),n},K=function(e){var t=Math.round(e.asHours());return isNaN(t)||0===t?null:t>=8?"".concat(t/8," day").concat(8===t?"":"s"):"".concat(t," hour").concat(t>1?"s":"")},Y=r(28),$=Object(Y.extendMoment)(P.a),Q=[{start:{hour:0,minute:0,second:0},end:{hour:0,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:0,minute:0,second:0},end:{hour:0,minute:0,second:0}}],X=function(e){for(var t=0,r=Array.from(e.by("day")),n=0;n<r.length;n++){var a=r[n],u=Q[a.day()],i=u.start,s=u.end,c=a.clone().set(i),o=a.clone().set(s),l=$.max(c,e.start),d=$.min(o,e.end);l<d&&(t+=d.diff(l))}return $.duration(t)},Z=Object(Y.extendMoment)(P.a),ee=function(e){var t=[],r=!0,n=!1,a=void 0;try{for(var u,i=function(){var r=u.value,n=e.reviews.filter(function(e){return e.prId===r.prId}).sort(function(e){return Z(e.reviewedAt).unix()}).filter(function(e){return Z(e.reviewedAt).isAfter(r.requestedAt)})[0];if(n){var a=Z.range(Z(r.requestedAt),Z(n.reviewedAt));t.push(X(a).asMilliseconds())}},s=e.reviewRequests[Symbol.iterator]();!(r=(u=s.next()).done);r=!0)i()}catch(c){n=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}return Z.duration(Object(G.mean)(t))},te=function(e){var t=[],r=!0,n=!1,a=void 0;try{for(var u,i=e.pullRequests[Symbol.iterator]();!(r=(u=i.next()).done);r=!0){var s=u.value;if(s.mergedAt){var c=Z.range(Z(s.commits[0].date),Z(s.mergedAt));t.push(X(c).asMilliseconds())}}}catch(o){n=!0,a=o}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return Z.duration(Object(G.mean)(t))},re=Object(_.withStyles)(function(e){return{main:{marginTop:4*e.spacing.unit,padding:4*e.spacing.unit}}})(function(e){var t=e.classes,r=e.data;return a.a.createElement(T.a,{className:t.main},a.a.createElement(B.a,null,a.a.createElement(F.a,null,a.a.createElement(J.a,null,a.a.createElement(U.a,null,"title"),a.a.createElement(U.a,null,"time to merge"),a.a.createElement(U.a,null,"created"))),a.a.createElement(D.a,null,r.pullRequests.map(function(e){return a.a.createElement(J.a,{key:e.id},a.a.createElement(U.a,null,e.title),a.a.createElement(U.a,null,K(function(e){var t=Z.range(Z(e.commits[0].date),Z(e.mergedAt));return Z.duration(X(t).asMilliseconds())}(e))),a.a.createElement(U.a,null,e.createdAt))}))))}),ne=Object(_.withStyles)(function(e){return{main:{marginTop:4*e.spacing.unit,padding:4*e.spacing.unit}}})(function(e){var t=e.classes,r=e.data,n=e.setView;return a.a.createElement(a.a.Fragment,null,a.a.createElement(T.a,{className:t.main},a.a.createElement(O.a,{variant:"h3",gutterBottom:!0},"time to respond to review requests"),a.a.createElement(O.a,{variant:"caption",gutterBottom:!0},"when a review is requested from somebody, how long does it take them to respond? this metric only counts time during work hours monday through friday."),a.a.createElement(B.a,null,a.a.createElement(F.a,null,a.a.createElement(J.a,null,a.a.createElement(U.a,null),a.a.createElement(U.a,null,"past 30 days"),a.a.createElement(U.a,null,"30 - 60 days"),a.a.createElement(U.a,null,"60 - 90 days"),a.a.createElement(U.a,null,"all time"))),a.a.createElement(D.a,null,function(e){var t=e.reviewRequests.map(function(e){return e.requestedReviewer}),r=e.reviews.map(function(e){return e.reviewer});return Object(G.uniq)(Object(G.intersection)(t,r))}(r).map(function(e){var t=function(e,t){var r=new E;return r.reviewRequests=e.reviewRequests.filter(function(e){return e.requestedReviewer===t}),r.reviews=e.reviews.filter(function(e){return e.reviewer===t}),r.pullRequests=e.pullRequests.filter(function(e){var t=e.id;return!!r.reviews.find(function(e){return e.prId===t})}),r.repositories=e.repositories.filter(function(e){var t=e.id;return!!r.pullRequests.find(function(e){return e.repoId===t})}),r}(r,e);return a.a.createElement(J.a,{key:e},a.a.createElement(U.a,null,e),a.a.createElement(U.a,null,K(ee(W(t,P()().subtract(30,"days"),P()())))),a.a.createElement(U.a,null,K(ee(W(t,P()().subtract(60,"days"),P()().subtract(30,"days"))))),a.a.createElement(U.a,null,K(ee(W(t,P()().subtract(90,"days"),P()().subtract(60,"days"))))),a.a.createElement(U.a,null,K(ee(t))))})))),a.a.createElement(T.a,{className:t.main},a.a.createElement(O.a,{variant:"h3",gutterBottom:!0},"time to merge pull requests"),a.a.createElement(O.a,{variant:"caption",gutterBottom:!0},"when somebody opens a pull request, how long is it between the first commit on the pull request and when it is merged? this metric only counts time during work hours monday through friday."),a.a.createElement(B.a,null,a.a.createElement(F.a,null,a.a.createElement(J.a,null,a.a.createElement(U.a,null),a.a.createElement(U.a,null,"past 30 days"),a.a.createElement(U.a,null,"30 - 60 days"),a.a.createElement(U.a,null,"60 - 90 days"),a.a.createElement(U.a,null,"all time"))),a.a.createElement(D.a,null,a.a.createElement(J.a,null,a.a.createElement(U.a,null),a.a.createElement(U.a,null,function(){var e=z(r,P()().subtract(30,"days"),P()());return a.a.createElement("a",{href:"",onClick:function(t){t.preventDefault(),n(a.a.createElement(re,{data:e}))}},K(te(e)))}()),a.a.createElement(U.a,null,K(te(z(r,P()().subtract(60,"days"),P()().subtract(30,"days"))))),a.a.createElement(U.a,null,K(te(z(r,P()().subtract(90,"days"),P()().subtract(60,"days"))))),a.a.createElement(U.a,null,K(te(r)))),function(e){return Object(G.uniq)(e.pullRequests.filter(function(e){return!!e.mergedAt}).map(function(e){return e.opener}))}(r).map(function(e){var t=function(e,t){var r=new E;return r.pullRequests=e.pullRequests.filter(function(e){var r=e.opener;return!!e.mergedAt&&r===t}),r.repositories=e.repositories.filter(function(e){var t=e.id;return!!r.pullRequests.find(function(e){return e.repoId===t})}),r.reviews=e.reviews.filter(function(e){var t=e.prId;return!!r.pullRequests.find(function(e){var r=e.id;return t===r})}),r.reviewRequests=e.reviewRequests.filter(function(e){var t=e.prId;return!!r.pullRequests.find(function(e){var r=e.id;return t===r})}),r}(r,e);return a.a.createElement(J.a,{key:e},a.a.createElement(U.a,null,a.a.createElement("a",{href:"",onClick:function(e){e.preventDefault(),n(a.a.createElement(re,{data:t}))}},e)),a.a.createElement(U.a,null,function(){var e=z(t,P()().subtract(30,"days"),P()());return a.a.createElement("a",{href:"",onClick:function(t){t.preventDefault(),n(a.a.createElement(re,{data:e}))}},K(te(e)))}()),a.a.createElement(U.a,null,K(te(z(t,P()().subtract(60,"days"),P()().subtract(30,"days"))))),a.a.createElement(U.a,null,K(te(z(t,P()().subtract(90,"days"),P()().subtract(60,"days"))))),a.a.createElement(U.a,null,K(te(t))))})))))}),ae=b.a.parse(location.search),ue=Object({NODE_ENV:"production",PUBLIC_URL:"/GithubMetrics",REACT_APP_CLIENT_ID:"18aa2b6ad64d1f1a3ce6",REACT_APP_REDIRECT_URI:"https://TomWoodward.github.io/GithubMetrics/",REACT_APP_ACCESS_TOKEN_HOST:"https://tcwoodward-github-metrics.herokuapp.com"}),ie=ue.REACT_APP_CLIENT_ID,se=ue.REACT_APP_REDIRECT_URI,ce=ue.REACT_APP_ACCESS_TOKEN_HOST,oe=function(e){function t(){var e,r;Object(s.a)(this,t);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];return(r=Object(o.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).state={loaded:!1},r.data=new k,r.receiveToken=function(e){localStorage.setItem("token",e),r.setState({token:e}),r.data.setToken(e),r.data.load().then(function(){return r.setState({loaded:!0})})},r.setView=function(e){r.setState({view:e})},r}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.assertAuthenticated()}},{key:"assertAuthenticated",value:function(){var e=localStorage.getItem("token");if(e)this.receiveToken(e);else if(ae.code&&"string"===typeof ae.code)this.getAccessToken(ae.code);else{var t=se+window.location.search;window.location.replace("https://github.com/login/oauth/authorize?client_id=".concat(ie,"&scope=user,repo&redirect_uri=").concat(t))}}},{key:"getAccessToken",value:function(e){var t=this;fetch("".concat(ce,"/authenticate/").concat(e)).then(function(e){return e.json()}).then(function(e){var r=e.token;return t.receiveToken(r)})}},{key:"render",value:function(){return!1===this.state.loaded?null:a.a.createElement("div",{className:this.props.classes.container},a.a.createElement(I.a,null),a.a.createElement(O.a,{variant:"h1"},"GitHub Metrics"),this.data.repositories.map(function(e){var t=e.fullName;return a.a.createElement(A.a,{key:t,label:t,variant:"outlined"})}),this.state.view?this.state.view:a.a.createElement(ne,{data:this.data,setView:this.setView}))}}]),t}(n.Component),le=Object(_.withStyles)(function(e){return{container:{margin:2*e.spacing.unit},main:{marginTop:4*e.spacing.unit,padding:4*e.spacing.unit}}})(oe);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(le,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},77:function(e,t,r){e.exports=r(185)}},[[77,1,2]]]);
//# sourceMappingURL=main.22f839fd.chunk.js.map