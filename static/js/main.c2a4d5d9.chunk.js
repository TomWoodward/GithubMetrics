(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{185:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),s=r(72),i=r.n(s),u=r(22),o=r(35),c=r(38),l=r(36),d=r(39),p=r(76),f=r(40),v=r(6),m=r.n(v),h=r(14),w=r(37),b=r.n(w),y=function e(){Object(u.a)(this,e),this.repositories=[],this.pullRequests=[],this.reviewRequests=[],this.reviews=[]},g=b.a.parse(location.search),q="string"===typeof g.repo?g.repo:null,R=function(e,t){return Object(h.a)(m.a.mark(function r(){var n,a,s;return m.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n="cache:".concat(e).concat(q?"?repo=".concat(q):""),!(a=localStorage.getItem(n))){r.next=8;break}return s=JSON.parse(a||"")||[],console.log("loaded ".concat(e,": ").concat(s.length)),r.abrupt("return",s);case 8:return r.next=10,t();case 10:s=r.sent,localStorage.setItem(n,JSON.stringify(s)),console.log("discovered ".concat(e,": ").concat(s.length));case 13:return r.abrupt("return",s);case 14:case"end":return r.stop()}},r)}))},k=function(e){function t(){var e,r;Object(u.a)(this,t);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(r=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).token=void 0,r.discoverRepositories=R("repositories",function(){g.org;var e=g.repo,t=function(e){return{fullName:e.full_name,id:e.id}};if(e)return r.query("/repos/".concat(e)).then(function(e){return[t(e)]});throw new Error("please don't make me load everything....")}),r.discoverPullRequests=R("pull-requests",Object(h.a)(m.a.mark(function e(){var t,n,a,s,i,u,o,c,l,d,p,f,v,h,w;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,a=!1,s=void 0,e.prev=4,i=r.repositories[Symbol.iterator]();case 6:if(n=(u=i.next()).done){e.next=48;break}return o=u.value,e.prev=8,e.next=11,r.queryAllPages("/repos/".concat(o.fullName,"/pulls"),{state:"all"});case 11:c=e.sent,l=!0,d=!1,p=void 0,e.prev=15,f=c[Symbol.iterator]();case 17:if(l=(v=f.next()).done){e.next=26;break}return h=v.value,e.next=21,r.queryAllPages("/repos/".concat(o.fullName,"/pulls/").concat(h.number,"/commits"));case 21:w=e.sent,t.push({opener:h.user.login,commits:w.map(function(e){return{date:e.commit.committer.date}}),mergedAt:h.merged_at,createdAt:h.created_at,title:h.title,repoFullName:o.fullName,repoId:o.id,id:h.number});case 23:l=!0,e.next=17;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(15),d=!0,p=e.t0;case 32:e.prev=32,e.prev=33,l||null==f.return||f.return();case 35:if(e.prev=35,!d){e.next=38;break}throw p;case 38:return e.finish(35);case 39:return e.finish(32);case 40:e.next=45;break;case 42:e.prev=42,e.t1=e.catch(8),console.error(e.t1);case 45:n=!0,e.next=6;break;case 48:e.next=54;break;case 50:e.prev=50,e.t2=e.catch(4),a=!0,s=e.t2;case 54:e.prev=54,e.prev=55,n||null==i.return||i.return();case 57:if(e.prev=57,!a){e.next=60;break}throw s;case 60:return e.finish(57);case 61:return e.finish(54);case 62:return e.abrupt("return",t);case 63:case"end":return e.stop()}},e,null,[[4,50,54,62],[8,42],[15,28,32,40],[33,,35,39],[55,,57,61]])}))),r.discoverReviewRequests=R("review-requests",Object(h.a)(m.a.mark(function e(){var t,n,a,s,i,u,o;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,a=!1,s=void 0,e.prev=4,i=m.a.mark(function e(){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.value,e.t0=t.push,e.t1=t,e.t2=f.a,e.next=6,r.queryAllPages("/repos/".concat(n.repoFullName,"/issues/").concat(n.id,"/events")).then(function(e){return e.filter(function(e){return"review_requested"===e.event}).map(function(e){return{prTitle:n.title,prId:n.id,requestedReviewer:e.requested_reviewer.login,requestedAt:e.created_at}})});case 6:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 9:case"end":return e.stop()}},e)}),u=r.pullRequests[Symbol.iterator]();case 7:if(n=(o=u.next()).done){e.next=12;break}return e.delegateYield(i(),"t0",9);case 9:n=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),a=!0,s=e.t1;case 18:e.prev=18,e.prev=19,n||null==u.return||u.return();case 21:if(e.prev=21,!a){e.next=24;break}throw s;case 24:return e.finish(21);case 25:return e.finish(18);case 26:return e.abrupt("return",t);case 27:case"end":return e.stop()}},e,null,[[4,14,18,26],[19,,21,25]])}))),r.discoverReviews=R("reviews",Object(h.a)(m.a.mark(function e(){var t,n,a,s,i,u,o;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,a=!1,s=void 0,e.prev=4,i=m.a.mark(function e(){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.value,e.t0=t.push,e.t1=t,e.t2=f.a,e.next=6,r.queryAllPages("/repos/".concat(n.repoFullName,"/pulls/").concat(n.id,"/reviews")).then(function(e){return e.map(function(e){return{prId:n.id,reviewer:e.user.login,reviewedAt:e.submitted_at,state:e.state}})});case 6:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 9:case"end":return e.stop()}},e)}),u=r.pullRequests[Symbol.iterator]();case 7:if(n=(o=u.next()).done){e.next=12;break}return e.delegateYield(i(),"t0",9);case 9:n=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),a=!0,s=e.t1;case 18:e.prev=18,e.prev=19,n||null==u.return||u.return();case 21:if(e.prev=21,!a){e.next=24;break}throw s;case 24:return e.finish(21);case 25:return e.finish(18);case 26:return e.abrupt("return",t);case 27:case"end":return e.stop()}},e,null,[[4,14,18,26],[19,,21,25]])}))),r}return Object(d.a)(t,e),Object(o.a)(t,[{key:"setToken",value:function(e){this.token=e}},{key:"load",value:function(){var e=Object(h.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.discoverRepositories();case 2:return this.repositories=e.sent,e.next=5,this.discoverPullRequests();case 5:return this.pullRequests=e.sent,e.next=8,this.discoverReviewRequests();case 8:return this.reviewRequests=e.sent,e.next=11,this.discoverReviews();case 11:this.reviews=e.sent;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryAllPages",value:function(){var e=Object(h.a)(m.a.mark(function e(t){var r,n,a,s,i,u=arguments;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=u.length>1&&void 0!==u[1]?u[1]:{},n=[],a=100,s=1,i=[];case 5:return e.next=7,this.query(t,Object(p.a)({},r,{page:String(s++),per_page:String(a)}));case 7:i=e.sent,n.push.apply(n,Object(f.a)(i));case 9:if(i.length===a){e.next=5;break}case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URL("https://api.github.com".concat(e));return Object.keys(t).forEach(function(e){return r.searchParams.append(e,t[e])}),fetch(r.toString(),{headers:{Authorization:"token ".concat(this.token)}}).then(function(e){return e.json()})}}]),t}(y),E=r(13),A=r(2),x=r.n(A),O=r(26),I=Object(O.extendMoment)(x.a),_=[{start:{hour:0,minute:0,second:0},end:{hour:0,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:9,minute:0,second:0},end:{hour:17,minute:0,second:0}},{start:{hour:0,minute:0,second:0},end:{hour:0,minute:0,second:0}}],j=function(e){for(var t=0,r=Array.from(e.by("day")),n=0;n<r.length;n++){var a=r[n],s=_[a.day()],i=s.start,u=s.end,o=a.clone().set(i),c=a.clone().set(u),l=I.max(o,e.start),d=I.min(c,e.end);l<d&&(t+=d.diff(l))}return I.duration(t)},S=Object(O.extendMoment)(x.a),T=function(e){var t=[],r=!0,n=!1,a=void 0;try{for(var s,i=function(){var r=s.value,n=e.reviews.filter(function(e){return e.prId===r.prId}).sort(function(e){return S(e.reviewedAt).unix()}).filter(function(e){return S(e.reviewedAt).isAfter(r.requestedAt)})[0];if(n){var a=S.range(S(r.requestedAt),S(n.reviewedAt));t.push(j(a).asMilliseconds())}},u=e.reviewRequests[Symbol.iterator]();!(r=(s=u.next()).done);r=!0)i()}catch(o){n=!0,a=o}finally{try{r||null==u.return||u.return()}finally{if(n)throw a}}return S.duration(Object(E.mean)(t))},N=function(e){var t=[],r=!0,n=!1,a=void 0;try{for(var s,i=e.pullRequests[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var u=s.value;if(u.mergedAt){var o=S.range(S(u.commits[0].date),S(u.mergedAt));t.push(j(o).asMilliseconds())}}}catch(c){n=!0,a=c}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return S.duration(Object(E.mean)(t))},P=r(49),C=r.n(P),B=r(51),M=r.n(B),D=r(4),L=r.n(D),U=r(50),H=r.n(U),J=r(27),F=r.n(J),W=r(75),z=r.n(W),G=r(48),K=r.n(G),Y=r(23),V=r.n(Y),$=r(73),Q=r.n($),X=r(47),Z=function(e,t,r){var n=new y;return n.reviewRequests=e.reviewRequests.filter(function(e){var n=e.requestedAt;return x()(n).isBetween(t,r)}),n.reviews=e.reviews.filter(function(t){var r=function(e,t){var r=e.reviews.filter(function(e){return e.prId===t.prId&&e.reviewer===t.reviewer&&x()(e.reviewedAt).isBefore(t.reviewedAt)}).sort(function(e){return x()(e.reviewedAt).unix()}).reverse()[0];return e.reviewRequests.filter(function(e){return e.prId===t.prId&&e.requestedReviewer===t.reviewer&&x()(e.requestedAt).isBefore(t.reviewedAt)&&(!r||x()(e.requestedAt).isAfter(r.reviewedAt))}).sort(function(e){return x()(e.reviewedAt).unix()}).reverse()[0]}(e,t);return r&&n.reviewRequests.indexOf(r)>-1}),n.pullRequests=e.pullRequests.filter(function(e){var t=e.id;return!!n.reviews.find(function(e){return e.prId===t})}),n.repositories=e.repositories.filter(function(e){var t=e.id;return!!n.pullRequests.find(function(e){return e.repoId===t})}),n},ee=function(e,t,r){var n=new y;return n.pullRequests=e.pullRequests.filter(function(e){var n=e.createdAt;return x()(n).isBetween(t,r)}),n.repositories=e.repositories.filter(function(e){var t=e.id;return!!n.pullRequests.find(function(e){return e.repoId===t})}),n.reviews=e.reviews.filter(function(e){var t=e.prId;return!!n.pullRequests.find(function(e){var r=e.id;return t===r})}),n.reviewRequests=e.reviewRequests.filter(function(e){var t=e.prId;return!!n.pullRequests.find(function(e){var r=e.id;return t===r})}),n},te=b.a.parse(location.search),re=Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_CLIENT_ID:"18aa2b6ad64d1f1a3ce6",REACT_APP_REDIRECT_URI:"https://github.com/TomWoodward/GithubMetrics",REACT_APP_ACCESS_TOKEN_HOST:"https://tcwoodward-github-metrics.herokuapp.com"}),ne=re.REACT_APP_CLIENT_ID,ae=re.REACT_APP_REDIRECT_URI,se=re.REACT_APP_ACCESS_TOKEN_HOST,ie=function(e){function t(){var e,r;Object(u.a)(this,t);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(r=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).state={loaded:!1},r.data=new k,r.receiveToken=function(e){localStorage.setItem("token",e),r.setState({token:e}),r.data.setToken(e),r.data.load().then(function(){return r.setState({loaded:!0})})},r}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.assertAuthenticated()}},{key:"assertAuthenticated",value:function(){var e=localStorage.getItem("token");if(e)this.receiveToken(e);else if(te.code&&"string"===typeof te.code)this.getAccessToken(te.code);else{var t=ae+window.location.search;window.location.replace("https://github.com/login/oauth/authorize?client_id=".concat(ne,"&scope=user,repo&redirect_uri=").concat(t))}}},{key:"getAccessToken",value:function(e){var t=this;fetch("".concat(se,"/authenticate/").concat(e)).then(function(e){return e.json()}).then(function(e){var r=e.token;return t.receiveToken(r)})}},{key:"render",value:function(){var e=this;if(!1===this.state.loaded)return null;var t,r=function(e){var t=Math.round(e.asHours());return isNaN(t)||0===t?null:"".concat(t," hour").concat(t>1?"s":"")};return a.a.createElement("div",{className:this.props.classes.container},a.a.createElement(Q.a,null),a.a.createElement(V.a,{variant:"h1"},"GitHub Metrics"),this.data.repositories.map(function(e){var t=e.fullName;return a.a.createElement(z.a,{key:t,label:t,variant:"outlined"})}),a.a.createElement(K.a,{className:this.props.classes.main},a.a.createElement(V.a,{variant:"h3",gutterBottom:!0},"time to respond to review requests"),a.a.createElement(V.a,{variant:"caption",gutterBottom:!0},"when a review is requested from somebody, how long does it take them to respond? this metric only counts time during work hours monday through friday."),a.a.createElement(C.a,null,a.a.createElement(H.a,null,a.a.createElement(F.a,null,a.a.createElement(L.a,null),a.a.createElement(L.a,null,"past 30 days"),a.a.createElement(L.a,null,"30 - 60 days"),a.a.createElement(L.a,null,"60 - 90 days"),a.a.createElement(L.a,null,"all time"))),a.a.createElement(M.a,null,function(e){var t=e.reviewRequests.map(function(e){return e.requestedReviewer}),r=e.reviews.map(function(e){return e.reviewer});return Object(E.uniq)(Object(E.intersection)(t,r))}(this.data).map(function(t){var n=function(e,t){var r=new y;return r.reviewRequests=e.reviewRequests.filter(function(e){return e.requestedReviewer===t}),r.reviews=e.reviews.filter(function(e){return e.reviewer===t}),r.pullRequests=e.pullRequests.filter(function(e){var t=e.id;return!!r.reviews.find(function(e){return e.prId===t})}),r.repositories=e.repositories.filter(function(e){var t=e.id;return!!r.pullRequests.find(function(e){return e.repoId===t})}),r}(e.data,t);return a.a.createElement(F.a,{key:t},a.a.createElement(L.a,null,t),a.a.createElement(L.a,null,r(T(Z(n,x()().subtract(30,"days"),x()())))),a.a.createElement(L.a,null,r(T(Z(n,x()().subtract(60,"days"),x()().subtract(30,"days"))))),a.a.createElement(L.a,null,r(T(Z(n,x()().subtract(90,"days"),x()().subtract(60,"days"))))),a.a.createElement(L.a,null,r(T(n))))})))),a.a.createElement(K.a,{className:this.props.classes.main},a.a.createElement(V.a,{variant:"h3",gutterBottom:!0},"time to merge pull requests"),a.a.createElement(V.a,{variant:"caption",gutterBottom:!0},"when somebody opens a pull request, how long is it between the first commit on the pull request and when it is merged? this metric only counts time during work hours monday through friday."),a.a.createElement(C.a,null,a.a.createElement(H.a,null,a.a.createElement(F.a,null,a.a.createElement(L.a,null),a.a.createElement(L.a,null,"past 30 days"),a.a.createElement(L.a,null,"30 - 60 days"),a.a.createElement(L.a,null,"60 - 90 days"),a.a.createElement(L.a,null,"all time"))),a.a.createElement(M.a,null,(t=this.data,Object(E.uniq)(t.pullRequests.filter(function(e){return!!e.mergedAt}).map(function(e){return e.opener}))).map(function(t){var n=function(e,t){var r=new y;return r.pullRequests=e.pullRequests.filter(function(e){var r=e.opener;return!!e.mergedAt&&r===t}),r.repositories=e.repositories.filter(function(e){var t=e.id;return!!r.pullRequests.find(function(e){return e.repoId===t})}),r.reviews=e.reviews.filter(function(e){var t=e.prId;return!!r.pullRequests.find(function(e){var r=e.id;return t===r})}),r.reviewRequests=e.reviewRequests.filter(function(e){var t=e.prId;return!!r.pullRequests.find(function(e){var r=e.id;return t===r})}),r}(e.data,t);return a.a.createElement(F.a,{key:t},a.a.createElement(L.a,null,t),a.a.createElement(L.a,null,r(N(ee(n,x()().subtract(30,"days"),x()())))),a.a.createElement(L.a,null,r(N(ee(n,x()().subtract(60,"days"),x()().subtract(30,"days"))))),a.a.createElement(L.a,null,r(N(ee(n,x()().subtract(90,"days"),x()().subtract(60,"days"))))),a.a.createElement(L.a,null,r(N(n))))})))))}}]),t}(n.Component),ue=Object(X.withStyles)(function(e){return{container:{margin:2*e.spacing.unit},main:{marginTop:4*e.spacing.unit,padding:4*e.spacing.unit}}})(ie);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(ue,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},77:function(e,t,r){e.exports=r(185)}},[[77,1,2]]]);
//# sourceMappingURL=main.c2a4d5d9.chunk.js.map